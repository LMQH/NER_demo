# 项目更新总结

## 更新概述

本次更新移除了对 `data` 和 `output` 文件夹以及环境配置文件的依赖，简化了项目配置和使用方式。

## 主要变更

### 1. 配置管理器 (`src/config_manager.py`) ✅

**变更内容**:
- 移除了环境配置文件加载功能（不再依赖 `env_loader`）
- 移除了 `data_dir` 和 `output_dir` 配置项
- 移除了 `get_data_dir()` 和 `get_output_dir()` 方法
- 简化了配置加载逻辑，只保留实体配置文件加载
- 实体配置文件路径可通过构造函数参数指定，默认为项目根目录下的 `entity_config.json`

**影响**:
- 不再需要 `dev.env` 和 `show.env` 配置文件
- 不再需要 `data` 和 `output` 目录
- 配置更加简洁，减少了环境相关的复杂性

### 2. 主业务逻辑 (`src/main.py`) ✅

**变更内容**:
- `process_files()` 方法改为接收文件内容字典作为参数，而不是从目录读取
- `save_results()` 方法改为可选的文件路径参数，如果不提供路径则返回 JSON 字符串

**影响**:
- 不再依赖 `data` 目录读取文件
- 不再依赖 `output` 目录保存结果
- 更加灵活，可以处理任意来源的文件内容

### 3. API 路由 - 实体抽取 (`src/api/routes/extract.py`) ✅

**变更内容**:
- 移除了批量抽取接口中从 `data` 目录读取文件的功能（方式2）
- 只保留通过 `files` 字段直接传递文件内容的方式
- 移除了对 `project_root` 的依赖

**影响**:
- API 接口更加简洁统一
- 所有文件内容都通过 API 请求直接传递，无需预先上传到服务器

### 4. API 路由 - 文件管理 (`src/api/routes/file.py`) ✅

**变更内容**:
- 文件上传接口标记为已废弃（返回 410 状态码）
- 多文件上传接口标记为已废弃（返回 410 状态码）
- 提示用户使用批量实体抽取接口直接传递文件内容

**影响**:
- 不再支持文件上传功能
- 所有文件处理都通过 API 请求体传递内容

### 5. API Schema (`src/api/schemas.py`) ✅

**变更内容**:
- `BatchExtractRequest` 中移除了 `file_names` 字段
- `files` 字段改为必需字段（不再是 Optional）

**影响**:
- API 接口定义更加清晰
- 强制要求通过 `files` 字段传递文件内容

### 6. 环境配置加载器 (`src/env_loader.py`) ✅

**变更内容**:
- 标记为已废弃模块
- 添加了废弃说明注释

**影响**:
- 模块保留但不再被使用
- 如需配置，请直接使用环境变量

## 使用方式变化

### 之前的方式

1. 需要创建 `dev.env` 和 `show.env` 配置文件
2. 需要创建 `data` 目录并放置待处理文件
3. 文件处理结果保存在 `output` 目录
4. 可以通过文件上传接口上传文件到 `data` 目录
5. 批量抽取可以通过文件名列表从 `data` 目录读取

### 现在的方式

1. **不需要**环境配置文件（`dev.env`、`show.env`）
2. **不需要** `data` 和 `output` 目录
3. 所有文件内容通过 API 请求直接传递
4. 处理结果通过 API 响应直接返回
5. 批量抽取必须通过 `files` 字段传递文件内容

## API 使用示例

### 单个文本抽取（无变化）

```json
POST /api/extract
{
  "Content": "广东省深圳市龙岗区坂田街道长坑路西2巷2号202 黄大大 18273778575",
  "model": "qwen-flash"
}
```

### 批量文件抽取（变化）

**之前**（已废弃）:
```json
POST /api/batch/extract
{
  "file_names": ["file1.txt", "file2.txt"],
  "model": "qwen-flash"
}
```

**现在**（必需）:
```json
POST /api/batch/extract
{
  "files": [
    {
      "filename": "file1.txt",
      "content": "文件1的内容..."
    },
    {
      "filename": "file2.txt",
      "content": "文件2的内容..."
    }
  ],
  "model": "qwen-flash"
}
```

## 配置要求

### 必需配置

1. **实体配置文件**: `entity_config.json`（项目根目录）
   - 可以通过 `ConfigManager(entity_config_path="...")` 指定其他路径
   - 如果文件不存在，将返回空配置

2. **环境变量**（如需要）:
   - `DASHSCOPE_API_KEY`: 用于 qwen-flash 模型（如果使用）

### 不再需要的配置

- ❌ `dev.env` 文件
- ❌ `show.env` 文件
- ❌ `data` 目录
- ❌ `output` 目录

## 兼容性说明

### 向后兼容

- ✅ 单个文本抽取接口完全兼容
- ✅ 实体配置文件格式兼容
- ✅ 模型加载和使用方式兼容

### 不兼容的变更

- ❌ 批量抽取接口不再支持 `file_names` 字段
- ❌ 文件上传接口已废弃
- ❌ `ConfigManager` 不再提供 `get_data_dir()` 和 `get_output_dir()` 方法
- ❌ `NERDemo.process_files()` 方法签名已更改

## 迁移指南

如果您之前使用了以下功能，需要进行迁移：

1. **从 data 目录读取文件**:
   - 改为通过 API 的 `files` 字段直接传递文件内容

2. **文件上传功能**:
   - 改为在客户端读取文件内容，然后通过批量抽取接口传递

3. **保存结果到 output 目录**:
   - 改为从 API 响应中获取结果并自行保存

4. **环境配置文件**:
   - 改为直接使用环境变量或代码配置

## 优势

1. **简化部署**: 不再需要创建和管理多个目录和配置文件
2. **更灵活**: 文件内容可以来自任何来源，不限于本地文件系统
3. **更安全**: 不需要在服务器上存储用户上传的文件
4. **更简洁**: 减少了配置复杂性，降低了维护成本
5. **更适合云服务**: 无状态设计更适合容器化和云部署

## 注意事项

1. 如果您的应用依赖文件上传功能，需要在前端或客户端实现文件读取和传递
2. 大文件处理时，注意 API 请求体大小限制
3. 如果需要持久化存储，请在客户端或应用层实现

